import{r,a as J,j as e,R,_ as T,e as I,x as M,k as Q,d as A}from"./index-fYIJ22hC.js";import{A as $}from"./arrow-left-C7VSTNop.js";import{S as U}from"./search-BdNovsjF.js";import{A as z}from"./index-BJlB8vhG.js";import{m as u}from"./proxy-Cxc5Icpb.js";import{X as F}from"./x-CrMldECL.js";import{M as O}from"./map-pin-DDqji2Q-.js";import{S as q}from"./star-B-XdTAma.js";const G=()=>e.jsx("div",{className:"flex gap-4 overflow-x-auto no-scrollbar py-2 px-1",children:[...Array(3)].map((s,l)=>e.jsx("div",{className:"w-64 h-64 bg-gray-100 rounded-2xl animate-pulse flex-shrink-0"},l))}),X=()=>e.jsx("div",{className:"flex flex-col gap-4",children:[...Array(4)].map((s,l)=>e.jsxs("div",{className:"flex gap-3 animate-pulse",children:[e.jsx("div",{className:"w-20 h-20 bg-gray-100 rounded-xl flex-shrink-0"}),e.jsxs("div",{className:"flex-1 space-y-2 py-1",children:[e.jsx("div",{className:"h-4 bg-gray-100 rounded w-3/4"}),e.jsx("div",{className:"h-3 bg-gray-100 rounded w-1/2"}),e.jsx("div",{className:"h-3 bg-gray-100 rounded w-1/4"})]})]},l))}),B=r.memo(({spot:s,navigate:l})=>{var c;return e.jsxs(u.div,{whileTap:{scale:.98},onClick:()=>l(`/spot/${s.id}`),className:"w-64 h-64 flex-shrink-0 relative cursor-pointer rounded-2xl overflow-hidden shadow-lg",children:[e.jsx("img",{src:s.featuredImageUrl||((c=s.imageUrls)==null?void 0:c[0])||"https://placehold.co/400x400",alt:s.name,loading:"lazy",className:"w-full h-full object-cover"}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-black/60 via-transparent"}),e.jsxs("div",{className:"absolute bottom-4 left-4 right-4",children:[e.jsx("h3",{className:"text-white font-semibold text-lg drop-shadow-md",children:s.name}),e.jsx("p",{className:"text-white/90 text-sm drop-shadow-md",children:s.city||s.category})]})]})}),H=r.memo(({spot:s,navigate:l})=>{var c;return e.jsxs(u.div,{initial:{opacity:0},animate:{opacity:1},whileTap:{scale:.99},onClick:()=>l(`/spot/${s.id}`),className:"flex items-center gap-4 p-2 -m-2 rounded-xl hover:bg-gray-50 cursor-pointer transition-colors",children:[e.jsx("img",{src:s.featuredImageUrl||((c=s.imageUrls)==null?void 0:c[0])||"https://placehold.co/100x100",alt:s.name,loading:"lazy",className:"w-20 h-20 rounded-xl object-cover flex-shrink-0"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-base font-semibold text-gray-900",children:s.name}),e.jsx("p",{className:"text-sm text-gray-500 capitalize",children:s.category||"Spot"}),e.jsxs("div",{className:"flex items-center gap-2 mt-1 text-sm text-gray-600",children:[e.jsx(O,{className:"w-3 h-3"}),e.jsx("span",{children:s.city||"Jaipur"}),e.jsx("span",{className:"text-gray-300",children:"|"}),e.jsx(q,{className:"w-3 h-3 text-yellow-500"}),e.jsx("span",{children:s.averageRating||"N/A"})]})]})]})});function te(){const[s,l]=r.useState(""),[c,N]=r.useState(!1),[f,b]=r.useState([]),[v,h]=r.useState([]),[p,y]=r.useState([]),[L,_]=r.useState([]),[d,w]=r.useState(!0),g=J(),x=r.useRef([]),S=(a,t)=>a.filter(n=>{var i,C;const o=((i=n.name)==null?void 0:i.toLowerCase())||"",m=((C=n.city)==null?void 0:C.toLowerCase())||"",j=n.tags_lowercase||[];return o.includes(t)||m.includes(t)||j.some(P=>P.includes(t))});r.useEffect(()=>{(async()=>{w(!0);try{const n=R(T(I,"spots"),M("averageRating","desc"),Q(5)),o=R(T(I,"spots")),[m,j]=await Promise.all([A(n),A(o)]);_(m.docs.map(i=>({id:i.id,...i.data()}))),x.current=j.docs.map(i=>({id:i.id,...i.data()}))}catch(n){console.error("Initial data fetch error:",n)}finally{w(!1)}})();const t=JSON.parse(localStorage.getItem("recentSearches")||"[]");y(t)},[]),r.useEffect(()=>{if(!s.trim()){h([]);return}if(d||!x.current.length)return;const a=s.toLowerCase(),t=S(x.current,a);h(t.slice(0,5))},[s,d]);const k=a=>{a==null||a.preventDefault();const t=s.trim().toLowerCase();if(!t||d||!x.current.length)return;N(!0),h([]);const n=S(x.current,t);b(n);const o=[s,...p.filter(m=>m!==s)].slice(0,5);y(o),localStorage.setItem("recentSearches",JSON.stringify(o))},D=a=>{l(a),setTimeout(()=>k({preventDefault:()=>{}}),50)},E=()=>{l(""),b([]),h([]),N(!1)};return e.jsxs("div",{className:"min-h-screen bg-white flex flex-col",children:[e.jsxs("div",{className:"sticky top-0 bg-white z-30 flex items-center gap-2 p-4 border-b border-gray-100",children:[e.jsx("button",{onClick:()=>g(-1),className:"p-2 text-gray-700 hover:bg-gray-100 rounded-full transition-colors","aria-label":"Go back",children:e.jsx($,{className:"w-5 h-5"})}),e.jsxs("form",{onSubmit:k,className:"relative flex-1 flex items-center bg-gray-100 rounded-full px-4 py-2.5 focus-within:ring-2 focus-within:ring-black",children:[e.jsx(U,{className:"w-4 h-4 text-gray-500"}),e.jsx("input",{type:"text",value:s,onChange:a=>l(a.target.value),placeholder:"Search spots, cities, or tags...",className:"bg-transparent outline-none text-sm w-full ml-2.5",inputMode:"search",autoFocus:!0,autoComplete:"off","aria-label":"Search"}),e.jsx(z,{children:s.length>0&&e.jsx(u.button,{initial:{opacity:0,scale:.5},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.5},type:"button",onClick:E,className:"p-1 bg-gray-300 rounded-full text-gray-600 hover:bg-gray-400","aria-label":"Clear search",children:e.jsx(F,{className:"w-3 h-3"})})})]})]}),e.jsx(z,{children:v.length>0&&e.jsx(u.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"absolute top-16 left-0 w-full bg-white z-20",children:e.jsx("div",{className:"p-4 pt-2 border-b border-gray-100 shadow-md",children:v.map(a=>{var t;return e.jsxs("div",{onClick:()=>g(`/spot/${a.id}`),className:"flex items-center gap-3 px-3 py-3 hover:bg-gray-50 cursor-pointer rounded-lg transition-colors",children:[e.jsx("img",{src:a.featuredImageUrl||((t=a.imageUrls)==null?void 0:t[0])||"https://placehold.co/64x64",alt:a.name,className:"w-10 h-10 rounded-lg object-cover"}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-semibold text-gray-900",children:a.name}),e.jsx("p",{className:"text-xs text-gray-500 capitalize",children:a.category||"Unknown category"})]})]},a.id)})})})}),e.jsxs("div",{className:"p-5 overflow-y-auto flex-1",children:[!c&&e.jsxs("div",{className:"space-y-8",children:[p.length>0&&e.jsxs("section",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Recent Searches"}),e.jsx("button",{onClick:()=>{y([]),localStorage.removeItem("recentSearches")},className:"text-xs text-gray-500 hover:text-gray-900",children:"Clear all"})]}),e.jsx("div",{className:"flex gap-2 flex-wrap",children:p.map((a,t)=>e.jsx("button",{onClick:()=>D(a),className:"bg-gray-100 text-gray-700 text-sm px-4 py-1.5 rounded-full hover:bg-gray-200 transition-colors",children:a},t))})]}),e.jsxs("section",{children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 mb-3",children:"Trending Spots"}),d?e.jsx(G,{}):e.jsx("div",{className:"flex gap-4 overflow-x-auto no-scrollbar py-2 px-1 -mx-1",children:L.map(a=>e.jsx(B,{spot:a,navigate:g},a.id))})]})]}),c&&e.jsx("section",{children:f.length>0?e.jsxs(e.Fragment,{children:[e.jsxs("h2",{className:"text-lg font-semibold text-gray-900 mb-4",children:["Results (",f.length,")"]}),e.jsx("div",{className:"flex flex-col gap-4",children:f.map(a=>e.jsx(H,{spot:a,navigate:g},a.id))})]}):e.jsxs("div",{className:"text-center text-gray-500 pt-20",children:[e.jsx(U,{className:"w-12 h-12 text-gray-300 mx-auto mb-4"}),e.jsx("h2",{className:"text-lg font-semibold",children:"No results found"}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"Try a different keyword, like “food” or “heritage”."})]})}),d&&!c&&e.jsx("div",{className:"pt-8",children:e.jsx(X,{})})]})]})}export{te as default};
