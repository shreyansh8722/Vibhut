import{n as F,a as G,b as M,r as a,j as e,o as U,i as $,e as C,h as q,R as E,_ as A,g as y,x as R,k as z,d as D,F as H}from"./index-fYIJ22hC.js";import{A as T}from"./arrow-left-C7VSTNop.js";import{m as P}from"./proxy-Cxc5Icpb.js";import{H as O}from"./heart-DVpuXnrv.js";import{S as Y}from"./star-B-XdTAma.js";const B=({src:t,alt:c,className:h})=>{const[l,g]=a.useState(!1);return e.jsxs("div",{className:"relative w-full h-full bg-gray-100",children:[" ",!l&&e.jsx("div",{className:"absolute inset-0 bg-gray-200 animate-pulse"}),e.jsx("img",{src:t,alt:c,loading:"lazy",onLoad:()=>g(!0),className:`${h} transition-opacity duration-300 ${l?"opacity-100":"opacity-0"}`})]})},J=()=>e.jsx("div",{className:"w-full h-64 bg-gray-200 rounded-2xl animate-pulse"}),K=a.memo(({spot:t,navigate:c,user:h})=>{var n;const[l,g]=a.useState(!1),i=t.featuredImageUrl||((n=t.imageUrls)==null?void 0:n[0])||"https://placehold.co/400x300";return e.jsxs(P.div,{layout:!0,initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},whileTap:{scale:.98},className:"relative rounded-2xl overflow-hidden shadow-md cursor-pointer group",onClick:()=>c(`/spot/${encodeURIComponent(t.id)}`),children:[e.jsxs("div",{className:"aspect-w-1 aspect-h-1",children:[" ",e.jsx(B,{src:i,alt:t.name,className:"w-full h-full object-cover"})]}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-black/60 via-transparent"}),e.jsx("button",{className:"absolute top-3 right-3 p-1.5 rounded-full bg-white/20 backdrop-blur-sm text-white hover:bg-white/30 transition-colors","aria-label":"Add to favorites",children:e.jsx(O,{size:16,fill:l?"currentColor":"none"})}),t.averageRating&&e.jsxs("div",{className:"absolute top-3 left-3 flex items-center gap-1 bg-black/40 text-white text-[10px] px-2 py-0.5 rounded-full backdrop-blur-sm",children:[e.jsx(Y,{size:10,className:"stroke-[1.5]"}),e.jsx("span",{children:t.averageRating})]}),e.jsxs("div",{className:"absolute bottom-3 left-3 right-3",children:[e.jsx("h3",{className:"text-white text-sm font-semibold line-clamp-2 leading-tight drop-shadow-sm",children:t.name}),e.jsx("p",{className:"text-white/80 text-xs mt-0.5 line-clamp-1",children:t.category})]})]})});function ee(){const{categoryId:t}=F(),c=G(),{user:h}=M(),[l,g]=a.useState(t),[i,n]=a.useState([]),[j,b]=a.useState(!0),[v,x]=a.useState(null),[N,k]=a.useState(!1),[L,f]=a.useState(null),[w,S]=a.useState(!1),p=12,o=sessionStorage.getItem("selectedCity");a.useEffect(()=>{if(!t||!o){x("Category or City not specified."),b(!1);return}(async()=>{b(!0),x(null),n([]),f(null),S(!1);try{try{const u=$(C,"categories",t),I=await q(u);I.exists()&&g(I.data().name||t)}catch(u){console.warn("Could not fetch category name:",u),g(t.charAt(0).toUpperCase()+t.slice(1))}const s=E(A(C,"spots"),y("category","==",t),y("cityId","==",o),R("name"),z(p)),d=await D(s),m=d.docs.map(u=>({id:u.id,...u.data()}));n(m),d.docs.length<p?S(!0):f(d.docs[d.docs.length-1])}catch(s){console.error("Error fetching category spots:",s),x("Could not load spots for this category.")}finally{b(!1)}})()},[t,o]);const _=async()=>{if(!(N||w||!L||!o||!t)){k(!0);try{const r=E(A(C,"spots"),y("category","==",t),y("cityId","==",o),R("name"),H(L),z(p)),s=await D(r),d=s.docs.map(m=>({id:m.id,...m.data()}));n(m=>[...m,...d]),s.docs.length<p?(S(!0),f(null)):f(s.docs[s.docs.length-1])}catch(r){console.error("Error loading more spots:",r),x("Could not load more spots.")}finally{k(!1)}}};return e.jsxs("div",{className:"min-h-screen bg-gray-50 pb-10",children:[e.jsxs("div",{className:"sticky top-0 z-30 bg-white shadow-sm py-3 px-4 flex items-center gap-3",children:[e.jsx("button",{onClick:()=>c(-1),className:"rounded-full p-2 -ml-2 hover:bg-gray-100","aria-label":"Go back",children:e.jsx(T,{})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-lg font-semibold capitalize",children:l}),o&&e.jsxs("p",{className:"text-xs text-gray-500",children:["in ",o]})]})]}),e.jsxs("div",{className:"p-4",children:[v&&e.jsx("div",{className:"text-center text-red-500 my-10",children:v}),j?e.jsx("div",{className:"grid grid-cols-2 gap-4",children:[...Array(6)].map((r,s)=>e.jsx(J,{},s))}):i.length===0&&!v?e.jsx("div",{className:"text-center text-gray-500 py-20",children:e.jsxs("p",{children:['No spots found for "',l,'" in ',o,"."]})}):e.jsx(P.div,{layout:!0,className:"grid grid-cols-2 gap-4",children:i.map(r=>e.jsx(K,{spot:r,navigate:c,user:h},r.id))}),e.jsxs("div",{className:"mt-8 text-center",children:[N&&e.jsx(U,{className:"w-6 h-6 animate-spin mx-auto text-gray-500"}),!j&&!N&&!w&&i.length>0&&e.jsx("button",{onClick:_,className:"bg-black text-white px-6 py-2.5 rounded-full font-medium transition-opacity hover:opacity-80",children:"Load More"}),!j&&w&&i.length>=p&&e.jsx("p",{className:"text-gray-500",children:"You've reached the end"})]})]})]})}export{ee as default};
