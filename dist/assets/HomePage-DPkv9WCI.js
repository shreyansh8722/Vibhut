const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./LoginPromptModal-B0NWoMcj.js","./index-fYIJ22hC.js","./index-C8RVZF19.css","./index-BJlB8vhG.js","./proxy-Cxc5Icpb.js","./x-CrMldECL.js","./mail-caHts6W3.js","./user-xfePk0rJ.js"])))=>i.map(i=>d[i]);
import{c as U,a as K,b as W,r as s,d as H,_ as T,e as M,j as e,L as Z,f as J,R as Y,g as B,k as ee,h as D,i as G,l as te,m as se,Q as ae}from"./index-fYIJ22hC.js";import{S as ie}from"./search-BdNovsjF.js";import{A as V}from"./index-BJlB8vhG.js";import{m as F}from"./proxy-Cxc5Icpb.js";import{X as ne}from"./x-CrMldECL.js";import{H as le}from"./heart-DVpuXnrv.js";import{S as oe}from"./star-B-XdTAma.js";import{C as re}from"./chevron-right-IT094RHK.js";/**
 * @license lucide-react v0.548.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ce=[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]],de=U("chevron-down",ce);/**
 * @license lucide-react v0.548.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ue=[["path",{d:"M10 5H3",key:"1qgfaw"}],["path",{d:"M12 19H3",key:"yhmn1j"}],["path",{d:"M14 3v4",key:"1sua03"}],["path",{d:"M16 17v4",key:"1q0r14"}],["path",{d:"M21 12h-9",key:"1o4lsq"}],["path",{d:"M21 19h-5",key:"1rlt1p"}],["path",{d:"M21 5h-7",key:"1oszz2"}],["path",{d:"M8 10v4",key:"tgpxqk"}],["path",{d:"M8 12H3",key:"a7s4jb"}]],me=U("sliders-horizontal",ue),fe=s.lazy(()=>J(()=>import("./LoginPromptModal-B0NWoMcj.js"),__vite__mapDeps([0,1,2,3,4,5,6,7]),import.meta.url)),xe=[{id:"All",label:"All"},{id:"Popular",label:"Popular"},{id:"Budget",label:"Budget Friendly"},{id:"Recommended",label:"Recommended"}];function pe(t,i){return!i||i==="All"?t:i==="Popular"?t.filter(o=>(o.averageRating??0)>=4.5):i==="Budget"?t.filter(o=>{var n;const c=(n=o.priceRange)==null?void 0:n.match(/\d+/g);return c&&Number(c[0])<=350}):i==="Recommended"?t.filter(o=>(o.reviewCount??0)>10):t}const he=({src:t,alt:i,className:o,isPriority:c=!1})=>{const[n,m]=s.useState(!1);return e.jsxs("div",{className:"relative w-full h-full",children:[!n&&e.jsx("div",{className:"absolute inset-0 bg-gray-200 animate-pulse rounded-2xl"}),e.jsx("img",{src:t,alt:i,loading:c?"eager":"lazy",fetchpriority:c?"high":"auto",onLoad:()=>m(!0),className:`${o} transition-opacity duration-500 ${n?"opacity-100":"opacity-0"}`})]})},Q=()=>e.jsx("div",{className:"w-[140px] h-[200px] bg-gray-200 rounded-2xl animate-pulse flex-shrink-0 mx-1"}),ge=s.memo(({spot:t,idx:i,activeIdx:o,navigate:c,user:n,showLoginPrompt:m,showToast:r,isPriority:N=!1})=>{var h;const[d,x]=s.useState(!1),L=t.featuredImageUrl||((h=t.imageUrls)==null?void 0:h[0])||"https://placehold.co/600x400",R=i===o;s.useEffect(()=>{let g=!0;return n&&t?D(G(M,"users",n.uid)).then(b=>{var u;if(!g)return;const f=((u=b.data())==null?void 0:u.favorites)||[];x(f.includes(t.id))}).catch(()=>{}):x(!1),()=>g=!1},[n,t]);const I=async g=>{var b;if(g.stopPropagation(),!n)return m();try{const f=G(M,"users",n.uid),l=(((b=(await D(f)).data())==null?void 0:b.favorites)||[]).includes(t.id);x(!l),await te(f,{favorites:l?se(t.id):ae(t.id)}),r(l?"Removed from favorites ðŸ’”":"Added to favorites â¤ï¸")}catch(f){console.error("Favorite update failed:",f)}};return e.jsxs(F.div,{"data-idx":i,layout:!0,whileTap:{scale:.97},animate:{scale:R?1.05:1},transition:{type:"spring",stiffness:260,damping:25},className:"relative flex-shrink-0 rounded-2xl overflow-hidden shadow-sm w-[140px] h-[200px] cursor-pointer mx-1 snap-start",onClick:()=>c(`/spot/${encodeURIComponent(t.id)}`),children:[e.jsx(he,{src:L,alt:t.name,className:"w-full h-full object-cover rounded-2xl",isPriority:N}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-black/70 via-transparent to-transparent rounded-2xl"}),e.jsx("button",{onClick:I,className:"absolute top-2 right-2 p-1.5 rounded-full bg-black/40 hover:bg-black/60 backdrop-blur-sm","aria-label":d?"Remove favorite":"Add to favorites",children:e.jsx(le,{size:15,className:`transition-all ${d?"fill-white text-white":"stroke-white"}`})}),t.averageRating&&e.jsxs("div",{className:"absolute top-2 left-2 flex items-center gap-1 bg-black/40 text-white text-[10px] px-2 py-[2px] rounded-full backdrop-blur-sm",children:[e.jsx(oe,{size:10,className:"stroke-[1.5]"}),e.jsx("span",{children:t.averageRating})]}),e.jsx("div",{className:"absolute bottom-3 left-3 right-3",children:e.jsx("h3",{className:"text-white text-[13px] font-semibold line-clamp-2 leading-tight drop-shadow-sm",children:t.name})})]})}),be=()=>{const[t,i]=s.useState(!1);return s.useEffect(()=>{const o=window.innerWidth<768,c=sessionStorage.getItem("swipeHintShown");o&&!c&&(i(!0),sessionStorage.setItem("swipeHintShown","true"),setTimeout(()=>i(!1),3e3))},[]),t?e.jsxs(F.div,{initial:{opacity:0,x:15},animate:{opacity:[0,1,0],x:[15,0,-10]},transition:{duration:2.2,ease:"easeInOut"},className:"absolute top-[45%] right-3 flex items-center gap-1 text-gray-500/70 text-xs font-medium select-none pointer-events-none",children:[e.jsx("span",{children:"Swipe"}),e.jsx(re,{size:13})]}):null},ye=(t,i="100px")=>{const[o,c]=s.useState(!1);return s.useEffect(()=>{let n=t.current;if(!n)return;const m=new IntersectionObserver(([r])=>{r.isIntersecting&&(c(!0),n&&m.unobserve(n))},{rootMargin:i});return m.observe(n),()=>{n&&m.unobserve(n)}},[t,i]),o},ve=s.memo(({category:t,selectedCity:i,globalFilter:o,isPriorityRow:c=!1,...n})=>{const[m,r]=s.useState([]),[N,d]=s.useState(!0),x=s.useRef(null),L=ye(x),[R,I]=s.useState(!1),[h,g]=s.useState(0),b=s.useRef(null),f=s.useCallback(()=>{const l=b.current;if(!l)return;const y=Array.from(l.querySelectorAll("[data-idx]"));if(!y.length)return;const v=l.getBoundingClientRect(),P=v.left+v.width/2;let C=0,w=1/0;y.forEach(a=>{const j=a.getBoundingClientRect(),z=j.left+j.width/2,S=Math.abs(z-P),E=Number(a.getAttribute("data-idx"));S<w&&(w=S,C=E)}),g(C)},[]);s.useEffect(()=>{if(!L||!t.id||!i||R)return;let l=!0;return(async()=>{d(!0);try{const v=Y(T(M,"spots"),B("category","==",t.id),B("cityId","==",i),ee(10)),P=await H(v);if(!l)return;const C=P.docs.map(w=>({id:w.id,...w.data()}));r(C),I(!0)}catch(v){console.error(`Failed to fetch spots for: ${t.id} in ${i}`,v)}finally{l&&d(!1)}})(),()=>l=!1},[L,t.id,i,R]),s.useEffect(()=>{I(!1),r([]),d(!0)},[i,t.id]);let u=t.name||t.id;t.id.toLowerCase().includes("food")||t.name&&t.name.toLowerCase().includes("food")?u=`Local eateries in ${i}`:t.id.toLowerCase().includes("heritage")||t.name&&t.name.toLowerCase().includes("heritage")?u=`Top spots in ${i}`:(t.id.toLowerCase().includes("artifact")||t.name&&t.name.toLowerCase().includes("artifact"))&&(u=`Local crafts in ${i}`);const A=pe(m,o);return!L&&!R?e.jsx("div",{ref:x,className:"h-[250px] w-full"}):!N&&A.length===0?null:e.jsxs("section",{ref:x,className:"mb-8 relative",children:[e.jsxs("div",{className:"flex justify-between items-center mb-3",children:[e.jsx("h2",{className:"text-lg font-semibold capitalize",children:u}),e.jsx(Z,{to:`/category/${t.id}`,className:"text-xs font-medium text-black bg-gray-100 px-3 py-1.5 rounded-full hover:bg-gray-200 transition-colors","aria-label":`See all ${u}`,children:"See All"})]}),e.jsx("div",{ref:b,onScroll:f,className:"flex gap-4 overflow-x-auto no-scrollbar py-2 px-[6px] scroll-smooth snap-x snap-mandatory",children:N?[1,2,3,4].map(l=>e.jsx(Q,{},l)):A.map((l,y)=>e.jsx(ge,{spot:l,idx:y,activeIdx:h,isPriority:c&&y===0,...n},l.id))}),A.length>2&&e.jsx(be,{})]})});function Ie(){var w;const t=K(),{user:i}=W(),[o,c]=s.useState([]),[n,m]=s.useState([]),[r,N]=s.useState(()=>sessionStorage.getItem("selectedCity")||""),[d,x]=s.useState(!0),[L,R]=s.useState(!1),[I,h]=s.useState(!1),[g,b]=s.useState("All"),[f,u]=s.useState(""),[A,l]=s.useState(!1),y=s.useCallback(a=>{u(a),setTimeout(()=>u(""),2e3)},[]),v=s.useCallback(()=>l(!0),[]),P=(((w=i==null?void 0:i.displayName)==null?void 0:w.split(" ")[0])||"Guest").replace(/[^A-Za-z]/g,"")||"Guest",C=s.useCallback(async()=>{x(!0);try{const[a,j]=await Promise.all([H(T(M,"cities")),H(T(M,"categories"))]),z=a.docs.map(p=>({id:p.id,...p.data()})),S=j.docs.map(p=>({id:p.id,...p.data()})),E=(p,k)=>p.find($=>$.id&&$.id.toLowerCase().includes(k)||$.name&&$.name.toLowerCase().includes(k)),O=[E(S,"food"),E(S,"heritage"),E(S,"artifact")].filter(Boolean),X=S.filter(p=>!O.some(k=>k.id===p.id)),q=O.concat(X);m(z),c(q.length?q:S),N(p=>{const k=sessionStorage.getItem("selectedCity");if(z.some(_=>_.name===k))return k;if(z.length>0){const _=z[0].name;return sessionStorage.setItem("selectedCity",_),_}return""})}catch(a){console.error("Failed to load cities/categories:",a)}finally{x(!1)}},[]);return s.useEffect(()=>(C(),()=>{}),[C]),s.useEffect(()=>{r&&!d&&n.some(a=>a.name===r)&&sessionStorage.setItem("selectedCity",r)},[r,d,n]),s.useEffect(()=>{const a=()=>{};return window.addEventListener("scroll",a,{passive:!0}),()=>window.removeEventListener("scroll",a)},[]),e.jsxs("div",{className:"min-h-screen bg-gradient-to-b from-[#fbfdff] to-white text-black pb-28",children:[e.jsxs("div",{className:"max-w-md mx-auto px-5 pt-6",children:[e.jsx("div",{className:"flex items-center justify-between mb-6",children:e.jsxs("div",{children:[e.jsxs("h1",{className:"text-2xl font-semibold mb-1",children:["Hello, ",P," ðŸ‘‹"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("p",{className:"text-gray-700 text-sm",children:"Letâ€™s explore"}),e.jsxs("div",{className:"relative flex items-center gap-1",children:[e.jsx("span",{className:`font-medium ${d&&!r?"text-gray-400":""}`,children:r||"Select City"}),e.jsx(de,{size:16,className:"text-gray-500"}),e.jsxs("select",{className:"absolute inset-0 opacity-0 cursor-pointer disabled:cursor-not-allowed",value:r,onChange:a=>N(a.target.value),"aria-label":"Select city",disabled:d,children:[!r&&e.jsx("option",{value:"",disabled:!0,children:"Select City"}),n.map(a=>e.jsx("option",{value:a.name,children:a.name},a.id))]})]})]})]})}),e.jsxs("div",{className:"flex items-center bg-gray-100 rounded-full px-4 py-3 mb-5 shadow-inner border border-gray-200",children:[e.jsx(ie,{size:18,className:"text-gray-500"}),e.jsx("input",{readOnly:!0,onClick:()=>t("/search"),placeholder:"Search destinations, eateries, heritage...",className:"bg-transparent w-full text-sm ml-3 placeholder-gray-500 focus:outline-none","aria-label":"Search"}),e.jsx("button",{onClick:()=>h(!0),className:"ml-2 p-2 rounded-full bg-black text-white","aria-label":"Open filters",children:e.jsx(me,{size:16})})]}),d?e.jsx("div",{className:"space-y-8",children:[1,2,3].map(a=>e.jsxs("div",{className:"animate-pulse",children:[e.jsx("div",{className:"h-5 bg-gray-200 rounded w-1/2 mb-3"}),e.jsx("div",{className:"flex gap-4 overflow-x-auto no-scrollbar py-2 px-[6px]",children:[1,2,3].map(j=>e.jsx(Q,{},j))})]},a))}):o.length===0?e.jsx("div",{className:"text-center text-gray-500 py-10",children:"No categories found."}):r?o.map((a,j)=>e.jsx(ve,{category:a,selectedCity:r,globalFilter:g,isPriorityRow:j===0,navigate:t,user:i,showToast:y,showLoginPrompt:v},`${r}-${a.id}`)):e.jsx("div",{className:"text-center text-gray-500 py-10",children:"Please select a city to see spots."})]}),e.jsx(V,{children:I&&e.jsx(F.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.15},className:"fixed inset-0 z-[60] bg-black/30 backdrop-blur-sm flex items-end",style:{willChange:"opacity"},onClick:()=>h(!1),children:e.jsxs(F.div,{initial:{y:"100%",opacity:0},animate:{y:0,opacity:1},exit:{y:"100%",opacity:0},transition:{type:"tween",ease:"easeOut",duration:.15},onClick:a=>a.stopPropagation(),className:"w-full max-w-md bg-white rounded-t-[28px] shadow-2xl p-6 pb-8 border-t border-gray-100",children:[e.jsx("div",{className:"w-10 h-1.5 bg-gray-300 rounded-full mx-auto mb-4"}),e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-800",children:"Filters"}),e.jsx("button",{onClick:()=>h(!1),className:"text-gray-500 hover:text-gray-700","aria-label":"Close filters",children:e.jsx(ne,{size:18})})]}),e.jsx("div",{className:"flex flex-wrap gap-3",children:xe.map(a=>e.jsx(F.button,{whileTap:{scale:.97,backgroundColor:"#00000010"},onClick:()=>{b(a.id),requestAnimationFrame(()=>h(!1))},className:`px-4 py-2 rounded-full text-sm font-medium transition ${g===a.id?"bg-black text-white":"bg-gray-100 text-gray-700"}`,children:a.label},a.id))})]})})}),e.jsx(s.Suspense,{fallback:null,children:e.jsx(fe,{open:A,onClose:()=>l(!1)})}),e.jsx(V,{children:f&&e.jsx(F.div,{initial:{opacity:0,y:40},animate:{opacity:1,y:0},exit:{opacity:0,y:40},transition:{duration:.3},className:"fixed bottom-24 left-1/2 -translate-x-1/2 bg-black/80 text-white text-sm px-4 py-2 rounded-full shadow-md backdrop-blur-md z-50",children:f})})]})}export{Ie as default};
