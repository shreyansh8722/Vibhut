const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./LoginPromptModal-B0NWoMcj.js","./index-fYIJ22hC.js","./index-C8RVZF19.css","./index-BJlB8vhG.js","./proxy-Cxc5Icpb.js","./x-CrMldECL.js","./mail-caHts6W3.js","./user-xfePk0rJ.js"])))=>i.map(i=>d[i]);
import{c as v,n as D,a as $,b as U,r as t,j as e,h as k,i as w,e as y,l as M,m as F,Q as q,L as A,R as X,k as H,x as B,g as G,_ as Q,d as Y,f as O}from"./index-fYIJ22hC.js";import{m as f}from"./proxy-Cxc5Icpb.js";import{A as V}from"./arrow-left-C7VSTNop.js";import{A as E}from"./index-BJlB8vhG.js";import{H as J}from"./heart-DVpuXnrv.js";import{C as K}from"./check-B_CjT2rm.js";import{S as _}from"./star-B-XdTAma.js";import{C as W}from"./chevron-right-IT094RHK.js";import{U as Z}from"./user-xfePk0rJ.js";/**
 * @license lucide-react v0.548.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ee=[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]],se=v("chevron-left",ee);/**
 * @license lucide-react v0.548.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const te=[["path",{d:"M12 6v6l4 2",key:"mmk7yg"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]],ae=v("clock",te);/**
 * @license lucide-react v0.548.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const re=[["circle",{cx:"18",cy:"5",r:"3",key:"gq8acd"}],["circle",{cx:"6",cy:"12",r:"3",key:"w7nqdw"}],["circle",{cx:"18",cy:"19",r:"3",key:"1xt0gg"}],["line",{x1:"8.59",x2:"15.42",y1:"13.51",y2:"17.49",key:"47mynk"}],["line",{x1:"15.41",x2:"8.59",y1:"6.51",y2:"10.49",key:"1n3mei"}]],le=v("share-2",re);/**
 * @license lucide-react v0.548.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ie=[["path",{d:"M12.586 2.586A2 2 0 0 0 11.172 2H4a2 2 0 0 0-2 2v7.172a2 2 0 0 0 .586 1.414l8.704 8.704a2.426 2.426 0 0 0 3.42 0l6.58-6.58a2.426 2.426 0 0 0 0-3.42z",key:"vktsd0"}],["circle",{cx:"7.5",cy:"7.5",r:".5",fill:"currentColor",key:"kqv944"}]],ne=v("tag",ie),oe=t.lazy(()=>O(()=>import("./LoginPromptModal-B0NWoMcj.js"),__vite__mapDeps([0,1,2,3,4,5,6,7]),import.meta.url)),ce=t.memo(()=>e.jsxs("div",{className:"animate-pulse",children:[e.jsx("div",{className:"w-full h-[400px] bg-gray-200"}),e.jsxs("div",{className:"px-6 mt-6 space-y-4",children:[e.jsx("div",{className:"h-6 bg-gray-200 rounded w-2/3"}),e.jsx("div",{className:"h-4 bg-gray-200 rounded w-1/3"}),e.jsx("div",{className:"h-4 bg-gray-200 rounded w-full"}),e.jsx("div",{className:"h-4 bg-gray-200 rounded w-5/6"}),e.jsx("div",{className:"h-4 bg-gray-200 rounded w-3/4"})]})]})),de=()=>e.jsxs("div",{className:"mt-6 flex items-center gap-3 bg-gray-50 p-3 rounded-xl border border-gray-100 animate-pulse",children:[e.jsx("div",{className:"w-8 h-8 bg-gray-200 rounded-full"}),e.jsxs("div",{className:"flex-1 space-y-2",children:[e.jsx("div",{className:"h-3 bg-gray-200 rounded w-1/4"}),e.jsx("div",{className:"h-4 bg-gray-200 rounded w-1/2"})]})]}),me=()=>e.jsx("style",{children:`
    .shimmer {
      position: absolute;
      inset: 0;
      background: linear-gradient(90deg, rgba(255,255,255,0) 0%, rgba(255,255,255,0.06) 50%, rgba(255,255,255,0) 100%);
      transform: translateX(-100%);
      animation: shimmer 900ms linear forwards;
    }
    @keyframes shimmer {
      to { transform: translateX(100%); }
    }
  `}),ue=t.memo(({images:a=[],spotName:m="Spot"})=>{const[l,s]=t.useState(0),i=t.useRef(null),o=n=>i.current=n.touches[0].clientX,p=n=>{if(i.current===null)return;const c=n.changedTouches[0].clientX-i.current;c<-50&&l<a.length-1&&s(g=>g+1),c>50&&l>0&&s(g=>g-1),i.current=null},h=Array.isArray(a)?a:[],u=h.length;return u===0?e.jsx("div",{className:"fixed top-0 left-0 w-full h-[400px] bg-gray-100 flex items-center justify-center z-0",children:e.jsx("img",{src:"https://placehold.co/600x400/eee/ccc?text=No+Image",alt:"No image available",className:"w-full h-full object-cover"})}):e.jsxs("div",{className:"fixed top-0 left-0 w-full h-[400px] overflow-hidden z-0 select-none",onTouchStart:o,onTouchEnd:p,children:[e.jsx(E,{initial:!1,children:e.jsx(f.img,{src:h[l],alt:`${m} image ${l+1}`,loading:l===0?"eager":"lazy",fetchPriority:l===0?"high":"auto",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.2},className:"absolute inset-0 w-full h-full object-cover pointer-events-none",draggable:"false"},l)}),u>1&&e.jsxs(e.Fragment,{children:[l>0&&e.jsx(f.button,{whileTap:{scale:.9},onClick:()=>s(n=>Math.max(0,n-1)),className:"absolute left-3 top-1/2 -translate-y-1/2 w-10 h-10 bg-white/40 backdrop-blur-sm text-white rounded-full shadow-lg flex items-center justify-center","aria-label":"Previous image",children:e.jsx(se,{size:20,className:"drop-shadow-sm"})}),l<u-1&&e.jsx(f.button,{whileTap:{scale:.9},onClick:()=>s(n=>Math.min(u-1,n+1)),className:"absolute right-3 top-1/2 -translate-y-1/2 w-10 h-10 bg-white/40 backdrop-blur-sm text-white rounded-full shadow-lg flex items-center justify-center","aria-label":"Next image",children:e.jsx(W,{size:20,className:"drop-shadow-sm"})}),e.jsxs("div",{className:"absolute bottom-4 left-1/2 -translate-x-1/2 bg-black/50 text-white text-xs px-2 py-1 rounded-full backdrop-blur-sm",children:[l+1," / ",u]})]})]})}),xe=t.memo(({ambassadorId:a})=>{const[m,l]=t.useState(null);return t.useEffect(()=>{if(!a)return;let s=!1;return k(w(y,"ambassadors",a)).then(i=>{i.exists()&&!s?l({id:i.id,...i.data()}):s||console.warn(`Ambassador with ID ${a} not found.`)}).catch(i=>console.error("Error fetching ambassador:",i)),()=>s=!0},[a]),a?m?e.jsxs(A,{to:`/ambassador/${m.id}`,className:"mt-6 flex items-center gap-3 bg-gray-50 p-3 rounded-xl border border-gray-100 hover:bg-gray-100 transition-colors",children:[e.jsx(Z,{className:"w-6 h-6 text-gray-500"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500",children:"Suggested by"}),e.jsx("p",{className:"text-sm font-medium",children:m.name||"Ambassador"})]})]}):e.jsx(de,{}):null}),fe=t.memo(({spotId:a})=>{const[m,l]=t.useState([]),[s,i]=t.useState(!0);return t.useEffect(()=>{if(!a)return;let o=!1;i(!0);const p=X(Q(y,"reviews"),G("spotId","==",a),B("createdAt","desc"),H(3));return Y(p).then(h=>{if(!o){const u=h.docs.map(n=>{const c=n.data(),g=c.username?c.username.split(" ")[0].split("@")[0]:"User";return{id:n.id,...c,username:g}});l(u),i(!1)}}).catch(h=>{console.error("Error fetching reviews preview:",h),o||i(!1)}),()=>o=!0},[a]),s?e.jsx("div",{className:"px-6 mt-8 text-sm text-gray-500",children:"Loading reviews..."}):e.jsxs("div",{className:"max-w-2xl mx-auto px-6 mt-8",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Reviews"}),e.jsx(A,{to:`/spot/${a}/reviews`,className:"text-black font-medium text-sm hover:underline",children:"See all →"})]}),m.length===0?e.jsx("p",{className:"text-gray-500 mt-2",children:"No reviews yet."}):e.jsx("ul",{className:"mt-4 space-y-4",children:m.map(o=>e.jsxs("li",{className:"bg-gray-50 p-4 rounded-xl shadow-sm border border-gray-100",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("p",{className:"font-medium text-sm",children:o.username}),e.jsxs("span",{className:"flex items-center gap-1 text-gray-800",children:[e.jsx(_,{className:"w-4 h-4 text-yellow-500"}),o.rating]})]}),e.jsx("p",{className:"text-gray-600 mt-1.5 text-sm leading-snug line-clamp-2",children:o.comment})]},o.id))})]})});function ke(){const{spotId:a}=D(),m=$(),{user:l}=U(),[s,i]=t.useState(null),[o,p]=t.useState(!0),[h,u]=t.useState(!1),[n,c]=t.useState(!1),[g,S]=t.useState(!0),[R,C]=t.useState(!1),j=t.useRef(0),b=t.useRef(!1),N=t.useCallback(()=>{const r=window.scrollY;b.current||(window.requestAnimationFrame(()=>{r>100&&r>j.current?S(!1):(r<j.current-10||r<=100)&&S(!0),j.current=r,b.current=!1}),b.current=!0)},[]);t.useEffect(()=>(window.addEventListener("scroll",N,{passive:!0}),()=>window.removeEventListener("scroll",N)),[N]),t.useEffect(()=>{if(!a)return;let r=!1;return(async()=>{p(!0);try{const x=await k(w(y,"spots",a));if(!x.exists()){r||i(null),console.error("Spot not found with ID:",a);return}const I={id:x.id,...x.data()};r||i(I)}catch(x){console.error("Error fetching spot details:",x),r||i(null)}finally{r||p(!1)}})(),()=>r=!0},[a]),t.useEffect(()=>{if(!l||!a){c(!1);return}(async()=>{var d;try{const x=await k(w(y,"users",l.uid));x.exists()&&((d=x.data().favorites)!=null&&d.includes(a))?c(!0):c(!1)}catch(x){console.error("Error checking favorite status:",x),c(!1)}})()},[l,a]);const T=async()=>{if(!l){C(!0);return}const r=w(y,"users",l.uid);try{await M(r,{favorites:n?F(a):q(a)}),c(!n)}catch(d){console.error("Error updating favorite:",d)}},z=async()=>{const r={title:(s==null?void 0:s.name)||"CitySaathi Spot",text:((s==null?void 0:s.fullDescription)||"").slice(0,120)+"...",url:window.location.href};try{navigator.share?await navigator.share(r):(await navigator.clipboard.writeText(window.location.href),u(!0),setTimeout(()=>u(!1),1500))}catch(d){console.error("Share failed:",d)}},L=t.useMemo(()=>{var r;return s?s.googleMapsUrl||((r=s.location)!=null&&r.latitude?`https://www.google.com/maps/search/?api=1&query=${s.location.latitude},${s.location.longitude}`:"https://maps.google.com"):"#"},[s]),P=t.useMemo(()=>{if(!s)return[];let r=[];return s.featuredImageUrl&&r.push(s.featuredImageUrl),Array.isArray(s.imageUrls)&&s.imageUrls.forEach(d=>{d&&d!==s.featuredImageUrl&&r.push(d)}),r},[s]);return o?e.jsx(ce,{}):s?e.jsxs(f.div,{initial:{opacity:0},animate:{opacity:1},transition:{duration:.25},className:"relative min-h-screen bg-white text-black overflow-hidden",children:[e.jsx(me,{}),e.jsx(ue,{images:P,spotName:s.name}),e.jsxs(f.div,{animate:{opacity:g?1:0,y:g?0:-10},transition:{duration:.2},className:"fixed top-6 left-0 w-full px-5 flex justify-between items-center z-20",children:[e.jsx(f.button,{whileTap:{scale:.9},onClick:()=>m(-1),className:"w-10 h-10 bg-white rounded-full shadow-lg flex items-center justify-center text-gray-800 hover:bg-gray-100 transition-colors","aria-label":"Go back",children:e.jsx(V,{size:20})}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx(f.button,{whileTap:{scale:.9},onClick:T,className:`w-10 h-10 bg-white rounded-full shadow-lg flex items-center justify-center hover:bg-gray-50 transition-colors ${n?"text-red-500":"text-gray-700"}`,"aria-label":n?"Remove from favorites":"Add to favorites",children:e.jsx(E,{mode:"wait",children:e.jsx(f.span,{initial:{scale:.8,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.8,opacity:0},transition:{duration:.15},style:{display:"inline-block"},children:e.jsx(J,{size:20,fill:n?"currentColor":"none"})},n?"filled":"empty")})}),e.jsx(f.button,{whileTap:{scale:.9},onClick:z,className:"w-10 h-10 bg-white rounded-full shadow-lg flex items-center justify-center text-gray-700 hover:bg-gray-50 transition-colors","aria-label":"Share spot",children:h?e.jsx(K,{size:20}):e.jsx(le,{size:20})})]})]}),e.jsxs("div",{className:"relative z-10 mt-[360px] bg-white rounded-t-[32px] shadow-lg pb-28",children:[e.jsxs("div",{className:"px-6 pt-8",children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsx("h1",{className:"text-[22px] font-semibold leading-snug text-gray-900 mr-4",children:s.name}),e.jsxs("div",{className:"flex flex-col items-end flex-shrink-0",children:[e.jsxs("div",{className:"flex items-center bg-gray-50 px-3 py-1 rounded-full text-sm",children:[e.jsx(_,{className:"text-black w-4 h-4 mr-1"}),s.averageRating??"—"]}),e.jsxs("span",{className:"text-xs text-gray-500 mt-1 whitespace-nowrap",children:[s.reviewCount??"0"," reviews"]})]})]}),e.jsx("p",{className:"mt-4 text-gray-700 leading-relaxed text-sm",children:s.fullDescription||"No description available."}),e.jsxs("div",{className:"mt-6 flex flex-wrap gap-x-4 gap-y-2 text-sm text-gray-700",children:[e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(ae,{className:"w-4 h-4"})," ",s.openingHours||"Timings vary"]}),e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(ne,{className:"w-4 h-4"})," ",s.priceRange||"Price varies"]})]}),s.ambassadorId&&e.jsx(xe,{ambassadorId:s.ambassadorId})]}),s.id&&e.jsx(fe,{spotId:s.id})]}),e.jsx("div",{className:"fixed bottom-6 left-1/2 -translate-x-1/2 w-[92%] max-w-md z-20",children:e.jsx("a",{href:L,target:"_blank",rel:"noopener noreferrer",className:"w-full flex justify-center bg-black text-white py-4 rounded-full shadow-lg font-medium hover:bg-gray-800 transition-colors",children:"Get Directions"})}),e.jsx(t.Suspense,{fallback:null,children:e.jsx(oe,{open:R,onClose:()=>C(!1)})})]}):e.jsx("div",{className:"p-10 text-center text-red-500",children:"Spot data could not be loaded or found."})}export{ke as default};
