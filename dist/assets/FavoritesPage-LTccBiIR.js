import{b as F,a as E,r as o,i as v,e as u,I as _,j as e,L as z,d as y,_ as b,h as M,l as A,m as I,Q as L,R as U,g as P}from"./index-fYIJ22hC.js";import{A as N}from"./arrow-left-C7VSTNop.js";import{H as w}from"./heart-DVpuXnrv.js";import{m as G}from"./proxy-Cxc5Icpb.js";import{M as H}from"./map-pin-DDqji2Q-.js";import{S as O}from"./star-B-XdTAma.js";const Q=()=>e.jsxs("div",{className:"max-w-2xl mx-auto px-4 animate-pulse",children:[e.jsx("div",{className:"h-5 bg-gray-200 rounded w-1/3 mb-4"}),e.jsx("div",{className:"flex flex-col gap-4",children:[...Array(3)].map((s,l)=>e.jsxs("div",{className:"flex gap-4 p-3 bg-white rounded-xl shadow-sm",children:[e.jsx("div",{className:"w-24 h-24 bg-gray-200 rounded-xl flex-shrink-0"}),e.jsxs("div",{className:"flex-1 space-y-2 py-1",children:[e.jsx("div",{className:"h-4 bg-gray-200 rounded w-3/4"}),e.jsx("div",{className:"h-3 bg-gray-200 rounded w-1/2"}),e.jsx("div",{className:"h-3 bg-gray-200 rounded w-1/4"})]}),e.jsx("div",{className:"w-8 h-8 bg-gray-200 rounded-full"})]},l))})]}),T=o.memo(({spot:s,onToggleFavorite:l,navigate:c})=>{var n;return e.jsxs(G.div,{layout:!0,initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,scale:.95},transition:{duration:.3},className:"flex items-center gap-4 p-3 bg-white rounded-2xl shadow-sm",children:[e.jsx("img",{src:s.featuredImageUrl||((n=s.imageUrls)==null?void 0:n[0])||"https://placehold.co/100x100",alt:s.name,loading:"lazy",className:"w-24 h-24 rounded-xl object-cover flex-shrink-0 cursor-pointer",onClick:()=>c(`/spot/${encodeURIComponent(s.id)}`)}),e.jsxs("div",{className:"flex-1 cursor-pointer",onClick:()=>c(`/spot/${encodeURIComponent(s.id)}`),children:[e.jsx("h3",{className:"text-base font-semibold text-gray-900",children:s.name}),e.jsx("p",{className:"text-sm text-gray-500 capitalize",children:s.category||"Spot"}),e.jsxs("div",{className:"flex items-center gap-2 mt-1 text-sm text-gray-600",children:[e.jsx(H,{className:"w-3 h-3"}),e.jsx("span",{children:s.city||"Jaipur"}),e.jsx("span",{className:"text-gray-300",children:"|"}),e.jsx(O,{className:"w-3 h-3 text-yellow-500"}),e.jsx("span",{children:s.averageRating||"N/A"})]})]}),e.jsx("button",{onClick:f=>{f.stopPropagation(),l(s.id)},className:"p-2 rounded-full text-red-500 bg-red-100/50 hover:bg-red-100 transition-colors","aria-label":"Remove from favorites",children:e.jsx(w,{size:18,fill:"currentColor"})})]})});function W(){const{user:s}=F(),l=E(),[c,n]=o.useState([]),[f,k]=o.useState({}),[h,x]=o.useState(!0);o.useEffect(()=>{if(!s){n([]),x(!1);return}x(!0);const t=v(u,"users",s.uid),r=_(t,async a=>{if(!a.exists()){n([]),x(!1);return}const i=a.data().favorites||[];if(!i.length){n([]),x(!1);return}const m=[],g=10;for(let d=0;d<i.length;d+=g)m.push(i.slice(d,d+g));const p=[];for(const d of m){const R=U(b(u,"spots"),P("__name__","in",d));(await y(R)).docs.forEach(j=>p.push({id:j.id,...j.data()}))}n(p),x(!1)});return()=>r()},[s]),o.useEffect(()=>{(async()=>{const r=await y(b(u,"cities")),a={};r.docs.forEach(i=>{a[i.id]=i.data().name||i.id}),k(a)})()},[]);const C=async t=>{if(!s)return;const r=v(u,"users",s.uid),a=await M(r);if(!a.exists())return;const m=(a.data().favorites||[]).includes(t);await A(r,{favorites:m?I(t):L(t)})},S=o.useMemo(()=>c.reduce((t,r)=>{const a=r.cityId||"unknown";return t[a]||(t[a]=[]),t[a].push(r),t},{}),[c]);return!h&&!c.length?e.jsxs("div",{className:"flex flex-col items-center justify-center min-h-screen text-gray-600 bg-white",children:[e.jsx("div",{className:"absolute top-0 left-0 w-full p-4",children:e.jsx("button",{onClick:()=>l(-1),className:"p-2 rounded-full hover:bg-gray-100","aria-label":"Go back",children:e.jsx(N,{size:20})})}),e.jsx("div",{className:"bg-gray-100 rounded-full w-20 h-20 flex items-center justify-center mb-4",children:e.jsx(w,{className:"w-10 h-10 text-gray-400"})}),e.jsx("h2",{className:"text-xl font-semibold",children:"No favorites yet"}),e.jsx("p",{className:"mt-2 text-sm text-gray-500",children:"Tap the heart icon on a spot to save it here."}),e.jsx(z,{to:"/",className:"mt-5 px-5 py-2 bg-black text-white rounded-full hover:bg-gray-800",children:"Explore Spots"})]}):e.jsx("div",{className:"min-h-screen bg-gray-50 py-5",children:e.jsxs("div",{className:"max-w-2xl mx-auto px-4",children:[e.jsxs("div",{className:"flex items-center mb-6 relative",children:[e.jsx("button",{onClick:()=>l(-1),className:"p-2 rounded-full hover:bg-gray-200 absolute left-0","aria-label":"Go back",children:e.jsx(N,{size:20})}),e.jsx("h1",{className:"text-2xl font-semibold text-center w-full",children:"My Favorites"})]}),h?e.jsx(Q,{}):e.jsx("div",{className:"space-y-8",children:Object.entries(S).map(([t,r])=>e.jsxs("section",{className:"mb-8",children:[e.jsx("h2",{className:"text-lg font-semibold mb-3 text-gray-800 tracking-tight",children:f[t]||"Other"}),e.jsx("div",{className:"flex flex-col gap-4",children:r.map(a=>e.jsx(T,{spot:a,onToggleFavorite:C,navigate:l},a.id))})]},t))})]})})}export{W as default};
